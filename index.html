<html>
    <head>
        <title>Natureescape</title>
        <script type="text/javascript" src="js/config.js"></script>
        <script type="text/javascript">
            var map, lyrs;
            $(document).ready(function () {
                map = new ol.Map({
                    target: 'map',
                    layers: [
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: blWMS,
                                params: {
                                    VERSION: "1.0.0",
                                    LAYERS: "ne_10m_admin_0_countries",
                                    FORMAT: "image/png"
                                }
                            }),
                        }),                                             
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: mcWMS,
                                params: {
                                    VERSION: "1.1.1",
                                    LAYERS: 'public.world_simple',
                                    FORMAT: 'image/png'
                                }
                            })
                        }),
                        
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: blWMS,
                                params: {
                                    VERSION: "1.0.0",
                                    LAYERS: "ne_10m_lakes",
                                    FORMAT: "image/png"
                                }
                            }),
                        }),
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: mcWMS,
                                params: {
                                    VERSION: "1.1.1",
                                    LAYERS: 'public.cities',
                                    FORMAT: 'image/png'
                                }
                            })
                        }),
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: chWMS,
                                params: {
                                    VERSION: "1.0.0",
                                    LAYERS: 'ch.bfs.volkszaehlung-bevoelkerungsstatistik_einwohner',
                                    FORMAT: 'image/png'
                                }
                            })
                        }), 
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: chWMS,
                                params: {
                                    VERSION: "1.0.0",
                                    LAYERS: 'ch.bav.kataster-belasteter-standorte-oev.oereb',
                                    FORMAT: 'image/png'
                                }
                            })
                        }), 
                        new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: chWMS,
                                params: {
                                    VERSION: "1.0.0",
                                    LAYERS: 'ch.bafu.laerm-strassenlaerm_tag',
                                    FORMAT: 'image/png'
                                }
                            })
                        }),
                        new ol.layer.Vector({
                            title: 'Parc Nationaux',
                            visible: true,
                            style: new ol.style.Style({
                                fill: new ol.style.Fill({
                                    color: [255, 153, 153, 0.5]
                                }),
                                stroke: new ol.style.Stroke({
                                    color: '#cb1d1d',
                                    width: 2
                                })
                            }),
                            source: new ol.source.Vector({
                                url: "https://celineobr.carto.com/api/v2/sql?q=select*from%20parcnationals&format=GeoJSON" + "&api_key=9891dd599397d4887e9d30914594856a78206c6f",
                                format: new ol.format.GeoJSON()
                            })
                         }),
                         new ol.layer.Vector({
                            title: 'Nature unesco',
                            visible: true,
                            style: new ol.style.Style({
                                fill: new ol.style.Fill({
                                    color: [100, 153, 100, 0.5]
                                }),
                                stroke: new ol.style.Stroke({
                                    color: [100, 153, 100, 0.5],
                                    width: 2
                                })
                            }),
                            source: new ol.source.Vector({
                                url: "https://celineobr.carto.com/api/v2/sql?q=select*from%20natureunesco&format=GeoJSON" + "&api_key=9891dd599397d4887e9d30914594856a78206c6f",
                                format: new ol.format.GeoJSON()
                            })
                         }),
                         new ol.layer.Vector({
                            title: 'Limites cantonales',
                            visible: true,
                            style: new ol.style.Style({
                                stroke: new ol.style.Stroke({
                                    color: [204,204, 204, 204],
                                    width: 2
                                })
                            }),
                            source: new ol.source.Vector({
                                url: "https://celineobr.carto.com/api/v2/sql?q=select*from%20limitescantonales&format=GeoJSON" + "&api_key=9891dd599397d4887e9d30914594856a78206c6f",
                                format: new ol.format.GeoJSON()
                            })
                         }),
                         new ol.layer.Image({
                            source: new ol.source.ImageWMS({
                                url: chWMS,
                                params: {
                                    VERSION: "1.0.0",
                                    LAYERS: 'ch.bafu.ren-wald',
                                    FORMAT: 'image/png',
                                    style: new ol.style.Style({
                                        fill: new ol.style.Fill({
                                            color: [30, 30, 30, 30]
                                        }),
                                        stroke: new ol.style.Stroke({
                                            color: [100, 153, 100, 0.5],
                                            width: 2
                                        })
                                    }),
                                },
                            })
                        }),
                        new ol.layer.Vector({
                            title: 'Lacs',
                            visible: true,
                            style: new ol.style.Style({
                                fill: new ol.style.Fill({
                                            color: [51, 119, 181, 0.5]
                                        }),
                                stroke: new ol.style.Stroke({
                                    color: [51, 119, 181, 254],
                                    width: 0.5
                                })
                            }),
                            source: new ol.source.Vector({
                                url: "https://celineobr.carto.com/api/v2/sql?q=select*from%20lac&format=GeoJSON" + "&api_key=9891dd599397d4887e9d30914594856a78206c6f",
                                format: new ol.format.GeoJSON()
                            })
                         }), 
                                                                 
                    ]
                });
                map.getView().setCenter(ol.proj.transform([8, 46.8], "EPSG:4326", "EPSG:3857"))
                map.getView().setZoom(8);

                initMyLayerSwitcher();
            });
            
            /***
             * initMyLayerSwitcher: a first attempt to manage baselayers and overlayers.
             * 
             * Remark: in the current state, the main drawback is that it is absolutly 
             * not flexible and adaptative!
             * 
             * @returns {undefined}
             */
            function initMyLayerSwitcher(){
                lyrs = map.getLayers().getArray();
                
                // Set visibility of the baselayer
                lyrs[0].setVisible(true);
                lyrs[1].setVisible(false);
                
                // Set visibility of the overlays
                lyrs[2].setVisible(false);
                lyrs[3].setVisible(false);
                $('#overlay option').prop('selected', false);

                // Define the callback when the user does change the baselayer
                $("#base").change(function (e) {
                    // Reset all baselayers
                    lyrs[0].setVisible(false);
                    lyrs[1].setVisible(false);

                    // Activate the one that is selected (based on index)
                    var idxVisible = $(this).find(":selected").index();
                    lyrs[idxVisible].setVisible(true);
                });

                // Define the callback when the user does change the overlays
                $("#overlay").change(function (e) {
                    $(this).find("option").each(function (i, e) {
                        // i + 2 because the 1st and 2nd elements in the table of layers are the baselayers
                        lyrs[i + 2].setVisible(e.selected);
                    });
                });                
            }
        </script>

        <style type="text/css">
            #map {
                width: 80%;
                height: 100%;
            }
            #switcher {
                position: absolute;
                left: 82%;
                top: 2%;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        
        <div id="switcher">
            <p>Choose baselayer:</p>
            <select id="base">
                <option value="base1">Countries</option>
                <option value="base2">World simple</option>
            </select>
            <p>Choose overlays:</p>
            <select id="overlay" size="2" multiple>
                <option value="overlay1">Lakes</option>
                <option value="overlay2">Cities</option>
                <!--<option value="overlay5">test</option>-->
            </select>        
        </div>
    </body>
</html>